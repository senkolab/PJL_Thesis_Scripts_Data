gamma_S = 95.3; %Decay rate of P_1/2 state to S_1/2 in MHz
gamma_D = 31; %Decay rate of P_1/2 state to D_3/2 in MHz
%Omega_S0 = 1*899.4180;
%Omega_S1 = 1*899.4180;
%Omega_D1 = 1*1.4169e+03;
%Omega_D2 = 1*1.4169e+03;
%Delta_S0 = -2*pi*20;
%Delta_S1 = -2*pi*20;
%Delta_D1 = -2*pi*200;
%Delta_D2 = -2*pi*200;

deltat = 0.0001;
t_end = 1;

t=0:deltat:t_end;
sigma_S0S0 = zeros(1,36); S0S0=1;
sigma_S1S1 = zeros(1,36); S1S1=2;
sigma_D1D1 = zeros(1,36); D1D1=3;
sigma_D2D2 = zeros(1,36); D2D2=4;
sigma_P0P0 = zeros(1,36); P0P0=5;
sigma_P1P1 = zeros(1,36); P1P1=6;
sigma_S0S1 = zeros(1,36); S0S1=7;
sigma_S0D1 = zeros(1,36); S0D1=8;
sigma_S0D2 = zeros(1,36); S0D2=9;
sigma_S0P0 = zeros(1,36); S0P0=10;
sigma_S0P1 = zeros(1,36); S0P1=11;
sigma_S1D1 = zeros(1,36); S1D1=12;
sigma_S1D2 = zeros(1,36); S1D2=13;
sigma_S1P0 = zeros(1,36); S1P0=14;
sigma_S1P1 = zeros(1,36); S1P1=15;
sigma_D1D2 = zeros(1,36); D1D2=16;
sigma_D1P0 = zeros(1,36); D1P0=17;
sigma_D1P1 = zeros(1,36); D1P1=18;
sigma_D2P0 = zeros(1,36); D2P0=19;
sigma_D2P1 = zeros(1,36); D2P1=20;
sigma_P0P1 = zeros(1,36); P0P1=21;
sigma_S1S0 = zeros(1,36); S1S0=22;
sigma_D1S0 = zeros(1,36); D1S0=23;
sigma_D2S0 = zeros(1,36); D2S0=24;
sigma_P0S0 = zeros(1,36); P0S0=25;
sigma_P1S0 = zeros(1,36); P1S0=26;
sigma_D1S1 = zeros(1,36); D1S1=27;
sigma_D2S1 = zeros(1,36); D2S1=28;
sigma_P0S1 = zeros(1,36); P0S1=29;
sigma_P1S1 = zeros(1,36); P1S1=30;
sigma_D2D1 = zeros(1,36); D2D1=31;
sigma_P0D1 = zeros(1,36); P0D1=32;
sigma_P1D1 = zeros(1,36); P1D1=33;
sigma_P0D2 = zeros(1,36); P0D2=34;
sigma_P1D2 = zeros(1,36); P1D2=35;
sigma_P1P0 = zeros(1,36); P1P0=36;

sigma_S0S0(S0S0) = 1;
sigma_S1S1(S1S1) = 1;
sigma_D1D1(D1D1) = 1;
sigma_D2D2(D2D2) = 1;
sigma_P0P0(P0P0) = 1;
sigma_P1P1(P1P1) = 1;
sigma_S0S1(S0S1) = 1;
sigma_S0D1(S0D1) = 1;
sigma_S0D2(S0D2) = 1;
sigma_S0P0(S0P0) = 1;
sigma_S0P1(S0P1) = 1;
sigma_S1D1(S1D1) = 1;
sigma_S1D2(S1D2) = 1;
sigma_S1P0(S1P0) = 1;
sigma_S1P1(S1P1) = 1;
sigma_D1D2(D1D2) = 1;
sigma_D1P0(D1P0) = 1;
sigma_D1P1(D1P1) = 1;
sigma_D2P0(D2P0) = 1;
sigma_D2P1(D2P1) = 1;
sigma_P0P1(P0P1) = 1;
sigma_S1S0(S1S0) = 1;
sigma_D1S0(D1S0) = 1;
sigma_D2S0(D2S0) = 1;
sigma_P0S0(P0S0) = 1;
sigma_P1S0(P1S0) = 1;
sigma_D1S1(D1S1) = 1;
sigma_D2S1(D2S1) = 1;
sigma_P0S1(P0S1) = 1;
sigma_P1S1(P1S1) = 1;
sigma_D2D1(D2D1) = 1;
sigma_P0D1(P0D1) = 1;
sigma_P1D1(P1D1) = 1;
sigma_P0D2(P0D2) = 1;
sigma_P1D2(P1D2) = 1;
sigma_P1P0(P1P0) = 1;

sigma_t = nan(numel(sigma_S0S0),numel(t));
sigma_t(:,1) = 0;
sigma_t(2,1) = 1;

Evol_Matrix = nan(numel(sigma_S0S0),numel(sigma_S0S0));

Evol_Matrix(S0S0,:) = (1i.*(Omega_S0/2).*(sigma_S0P1-sigma_P1S0)...
    +(1/4)*gamma_S.*sigma_P1P1);
Evol_Matrix(S1S1,:) = (1i.*(Omega_S1/2).*(sigma_S1P0-sigma_P0S1)...
    +(3/4)*gamma_S.*sigma_P1P1 + gamma_S.*sigma_P0P0);
Evol_Matrix(D1D1,:) = (1i.*(Omega_D1/2).*(sigma_D1P0-sigma_P0D1)...
    +(3/8)*gamma_D.*sigma_P1P1 + gamma_D.*sigma_P0P0);
Evol_Matrix(D2D2,:) = (1i.*(Omega_D2/2).*(sigma_D2P1-sigma_P1D2)...
    +(5/8)*gamma_D.*sigma_P1P1);
Evol_Matrix(P1P1,:) = (1i.*(Omega_S0/2).*(-sigma_S0P1+sigma_P1S0)...
    +1i.*(Omega_D2/2).*(-sigma_D2P1+sigma_P1D2)...
    -(gamma_S + gamma_D).*sigma_P1P1);
Evol_Matrix(P0P0,:) = (1i.*(Omega_S1/2).*(-sigma_S1P0+sigma_P0S1)...
    +1i.*(Omega_D1/2).*(-sigma_D1P0+sigma_P0D1)...
    -(gamma_S + gamma_D).*sigma_P0P0);
Evol_Matrix(S0S1,:) = (1i.*(Omega_S1/2).*sigma_S0P0...
    -1i.*(Omega_S0/2).*sigma_P1S1);
Evol_Matrix(S0D1,:) = (1i.*(Omega_D1/2).*sigma_S0P0...
    +1i.*(Delta_D1-Delta_S1).*sigma_S0D1...
    -1i.*(Omega_S0/2).*sigma_P1D1);
Evol_Matrix(S0D2,:) = (1i.*(Omega_D2/2).*sigma_S0P1...
    +1i.*(Delta_D2-Delta_S0).*sigma_S0D2...
    -1i.*(Omega_S0/2).*sigma_P1D2);
Evol_Matrix(S0P0,:) = (1i.*(Omega_S1/2).*sigma_S0S1...
    +1i.*(Omega_D1/2).*sigma_S0D1...
    -1i.*Delta_S1.*sigma_S0P0...
    -1i.*(Omega_S0/2).*sigma_P1P0...
    -((gamma_S+gamma_D)./2).*sigma_S0P0);
Evol_Matrix(S0P1,:) = (1i.*(Omega_S0/2).*(sigma_S0S0 - sigma_P1P1)...
    +1i.*(Omega_D2/2).*sigma_S0D2...
    -1i.*Delta_S0.*sigma_S0P1...
    -((gamma_S+gamma_D)./2).*sigma_S0P1);
Evol_Matrix(S1D1,:) = (1i.*(Omega_D1/2).*sigma_S1P0...
    +1i.*(Delta_D1-Delta_S1).*sigma_S1D1...
    -1i.*(Omega_S1/2).*sigma_P0D1);
Evol_Matrix(S1D2,:) = (1i.*(Omega_D2/2).*sigma_S1P1...
    +1i.*(Delta_D2-Delta_S0).*sigma_S1D2...
    -1i.*(Omega_S1/2).*sigma_P0D2);
Evol_Matrix(S1P0,:) = (1i.*(Omega_S1/2).*(sigma_S1S1 - sigma_P0P0)...
    +1i.*(Omega_D1/2).*sigma_S1D1...
    -1i.*Delta_S1.*sigma_S1P0...
    -((gamma_S+gamma_D)./2).*sigma_S1P0);
Evol_Matrix(S1P1,:) = (1i.*(Omega_S0/2).*sigma_S1S0...
    +1i.*(Omega_D2/2).*sigma_S1D2...
    -1i.*Delta_S0.*sigma_S1P1...
    -1i.*(Omega_S1/2).*sigma_P0P1...
    -((gamma_S+gamma_D)./2).*sigma_S1P1);
Evol_Matrix(D1D2,:) = (1i.*(Delta_D2 - Delta_S0).*sigma_D1D2...
    +1i.*(Omega_D2/2).*sigma_D1P1...
    -1i.*(Delta_D1 - Delta_S1).*sigma_D1D2...
    -1i.*(Omega_D1/2).*sigma_P0D2);
Evol_Matrix(D1P0,:) = (1i.*(Omega_D1/2).*(sigma_D1D1 - sigma_P0P0)...
    +1i.*(Omega_S1/2).*sigma_D1S1...
    -1i.*Delta_D1.*sigma_D1P0...
    -((gamma_S+gamma_D)./2).*sigma_D1P0);
Evol_Matrix(D1P1,:) = (1i.*(Omega_S0/2).*sigma_D1S0...
    +1i.*(Omega_D2/2).*sigma_D1D2...
    -1i.*Delta_S0.*sigma_D1P1...
    -1i.*(Delta_D1 - Delta_S1).*sigma_D1P1...
    -1i.*(Omega_D1/2).*sigma_P0P1...
    -((gamma_S+gamma_D)./2).*sigma_D1P1);
Evol_Matrix(D2P0,:) = (1i.*(Omega_S1/2).*sigma_D2S1...
    +1i.*(Omega_D1/2).*sigma_D2D1...
    -1i.*Delta_S1.*sigma_D2P0...
    -1i.*(Delta_D2 - Delta_S0).*sigma_D2P0...
    -1i.*(Omega_D2/2).*sigma_P1P0...
    -((gamma_S+gamma_D)./2).*sigma_D2P0);
Evol_Matrix(D2P1,:) = (1i.*(Omega_D2/2).*(sigma_D2D2-sigma_P1P1)...
    +1i.*(Omega_S0/2).*sigma_D2S0...
    -1i.*Delta_S0.*sigma_P1D2...
    -1i.*(Delta_D2 - Delta_S0).*sigma_D2P1...
    -((gamma_S+gamma_D)./2).*sigma_D2P1);
Evol_Matrix(P0P1,:) = (1i.*(Omega_S0/2).*sigma_P0S0...
    +1i.*(Omega_D2/2).*sigma_P0D2...
    -1i.*Delta_S0.*sigma_P0P1...
    -1i.*(Omega_S1/2).*sigma_S1P1...
    +1i.*(Omega_D1/2).*sigma_D1P1...
    +1i.*Delta_S1.*sigma_P0P1);
Evol_Matrix(S1S0,:) = conj(1i.*(Omega_S1/2).*sigma_P0S0...
    -1i.*(Omega_S0/2).*sigma_S1P1);
Evol_Matrix(D1S0,:) = conj(1i.*(Omega_D1/2).*sigma_P0S0...
    +1i.*(Delta_D1-Delta_S1).*sigma_D1S0...
    -1i.*(Omega_S0/2).*sigma_D1P1);
Evol_Matrix(D2S0,:) = conj(1i.*(Omega_D2/2).*sigma_P1S0...
    +1i.*(Delta_D2-Delta_S0).*sigma_D2S0...
    -1i.*(Omega_S0/2).*sigma_D2P1);
Evol_Matrix(P0S0,:) = conj(1i.*(Omega_S1/2).*sigma_S1S0...
    +1i.*(Omega_D1/2).*sigma_D1S0...
    -1i.*Delta_S1.*sigma_P0S0...
    -1i.*(Omega_S0/2).*sigma_P0P1...
    -((gamma_S+gamma_D)./2).*sigma_P0S0);
Evol_Matrix(P1S0,:) = conj(1i.*(Omega_S0/2).*(sigma_S0S0 - sigma_P1P1)...
    +1i.*(Omega_D2/2).*sigma_D2S0...
    -1i.*Delta_S0.*sigma_P1S0...
    -((gamma_S+gamma_D)./2).*sigma_P1S0);
Evol_Matrix(D1S1,:) = conj(1i.*(Omega_D1/2).*sigma_P0S1...
    +1i.*(Delta_D1-Delta_S1).*sigma_D1S1...
    -1i.*(Omega_S1/2).*sigma_D1P0);
Evol_Matrix(D2S1,:) = conj(1i.*(Omega_D2/2).*sigma_P1S1...
    +1i.*(Delta_D2-Delta_S0).*sigma_D2S1...
    -1i.*(Omega_S1/2).*sigma_D2P0);
Evol_Matrix(P0S1,:) = conj(1i.*(Omega_S1/2).*(sigma_S1S1 - sigma_P0P0)...
    +1i.*(Omega_D1/2).*sigma_D1S1...
    -1i.*Delta_S1.*sigma_P0S1...
    -((gamma_S+gamma_D)./2).*sigma_P0S1);
Evol_Matrix(P1S1,:) = conj(1i.*(Omega_S0/2).*sigma_S0S1...
    +1i.*(Omega_D2/2).*sigma_D2S1...
    -1i.*Delta_S0.*sigma_P1S1...
    -1i.*(Omega_S1/2).*sigma_P1P0...
    -((gamma_S+gamma_D)./2).*sigma_P1S1);
Evol_Matrix(D2D1,:) = conj(1i.*(Delta_D2 - Delta_S0).*sigma_D2D1...
    +1i.*(Omega_D2/2).*sigma_P1D1...
    -1i.*(Delta_D1 - Delta_S1).*sigma_D2D1...
    -1i.*(Omega_D1/2).*sigma_D2P0);
Evol_Matrix(P0D1,:) = conj(1i.*(Omega_D1/2).*(sigma_D1D1 - sigma_P0P0)...
    +1i.*(Omega_S1/2).*sigma_S1D1...
    -1i.*Delta_S1.*sigma_P0D1...
    -1i.*(Delta_D1 - Delta_S1).*sigma_P0D1...
    -((gamma_S+gamma_D)./2).*sigma_P0D1);
Evol_Matrix(P1D1,:) = conj(1i.*(Omega_S0/2).*sigma_S0D1...
    +1i.*(Omega_D2/2).*sigma_D2D1...
    -1i.*Delta_S0.*sigma_P1D1...
    -1i.*(Delta_D1 - Delta_S1).*sigma_P1D1...
    -1i.*(Omega_D1/2).*sigma_P1P0...
    -((gamma_S+gamma_D)./2).*sigma_P1D1);
Evol_Matrix(P0D2,:) = conj(1i.*(Omega_S1/2).*sigma_S1D2...
    +1i.*(Omega_D1/2).*sigma_D1D2...
    -1i.*Delta_S1.*sigma_P0D2...
    -1i.*(Delta_D2 - Delta_S0).*sigma_P0D2...
    -1i.*(Omega_D2/2).*sigma_P0P1...
    -((gamma_S+gamma_D)./2).*sigma_P0D2);
Evol_Matrix(P1D2,:) = conj(1i.*(Omega_D2/2).*(sigma_D2D2-sigma_P1P1)...
    +1i.*(Omega_S0/2).*sigma_S0D2...
    -1i.*Delta_S0.*sigma_D2P1...
    -1i.*(Delta_D2 - Delta_S0).*sigma_P1D2...
    -((gamma_S+gamma_D)./2).*sigma_P1D2);
Evol_Matrix(P1P0,:) = conj(1i.*(Omega_S0/2).*sigma_S0P0...
    +1i.*(Omega_D2/2).*sigma_D2P0...
    -1i.*Delta_S0.*sigma_P1P0...
    -1i.*(Omega_S1/2).*sigma_P1S1...
    +1i.*(Omega_D1/2).*sigma_P1D1...
    +1i.*Delta_S1.*sigma_P1P0);

for h=2:numel(t)
    sigma_t_k1 = Evol_Matrix*sigma_t(:,h-1).*(t(h)-t(h-1));
    sigma_t_k2 = Evol_Matrix*(sigma_t(:,h-1)+sigma_t_k1./2).*(t(h)-t(h-1));
    sigma_t_k3 = Evol_Matrix*(sigma_t(:,h-1)+sigma_t_k2./2).*(t(h)-t(h-1));
    sigma_t_k4 = Evol_Matrix*(sigma_t(:,h-1)+sigma_t_k3).*(t(h)-t(h-1));
    
    sigma_t(:,h) = sigma_t(:,h-1) + (1/6).*(sigma_t_k1+2.*sigma_t_k2+2.*sigma_t_k3+sigma_t_k4);
end